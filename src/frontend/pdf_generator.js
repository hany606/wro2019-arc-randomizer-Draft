'use strict';

import * as jsPDF from 'jspdf';
import * as h2c from 'html2canvas';

const A4_SIZE = {width: 210, height: 297};

export default function generate() {
    let logo = document.getElementsByTagName("img")[0];
    let field = document.getElementById("field-canvas");
    let qr_codes = document.getElementById('qr-codes')

    let true_encoded_string = document.getElementById("true-encoded-field");
    let encoded_string_top_right = document.getElementById("encoded-field-top-right");
    let encoded_string_top_left = document.getElementById("encoded-field-top-left");
    let encoded_string_bottom_left = document.getElementById("encoded-field-bottom-left");
    let encoded_string_bottom_right = document.getElementById("encoded-field-bottom-right");
    
    let element_coords = document.getElementById("field-descr");

    let doc = new jsPDF({ unit: 'mm', format: "a4" });

    let shift = 0;
    for (let coords of element_coords.children) {
        doc.text(coords.innerText, 120, 15 + shift);
        shift += 10;
    }

    doc.addImage(logo, 'PNG', 15, 0, 55, 10);
    doc.addImage(field, 'PNG', 15, 15, 100, 100);
    doc.setFontSize(12);
    doc.text(true_encoded_string.innerText, 120, 80);
    doc.text(encoded_string_top_right.innerText, 120, 85);
    doc.text(encoded_string_top_left.innerText, 120, 90);
    doc.text(encoded_string_bottom_left.innerText, 120, 95);
    doc.text(encoded_string_bottom_right.innerText, 120, 100);
    h2c(qr_codes).then(function(canvas){
        doc.addImage(canvas, 'PNG', 15, 120, 150, 150);
    });
    
    doc.text("Generated by " + window.location.href, 15, A4_SIZE.height - 10);

    doc.save('a4.pdf');
}
